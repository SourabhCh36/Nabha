<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz - Online Exam System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px 0;
        }

        .quiz-container {
            max-width: 900px;
            margin: 0 auto;
        }

        .quiz-header {
            background: white;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .quiz-title {
            font-size: 28px;
            color: #333;
            margin-bottom: 10px;
        }

        .quiz-info {
            display: flex;
            justify-content: space-between;
            gap: 20px;
            margin-top: 15px;
            font-size: 16px;
        }

        .info-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .timer {
            font-weight: bold;
            color: #e74c3c;
        }

        .quiz-question {
            background: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .question-number {
            font-size: 14px;
            color: #7f8c8d;
            margin-bottom: 10px;
        }

        .question-text {
            font-size: 20px;
            color: #333;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .question-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .option {
            padding: 15px;
            border: 2px solid #e8e8e8;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            background: #f9f9f9;
        }

        .option:hover {
            border-color: #667eea;
            background: #f0f3ff;
        }

        .option.selected {
            border-color: #667eea;
            background: #e8ecff;
            font-weight: 500;
        }

        .option input[type="radio"],
        .option input[type="text"] {
            cursor: pointer;
            margin-right: 10px;
        }

        .option input[type="text"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-top: 10px;
        }

        .descriptive-answer {
            width: 100%;
            min-height: 120px;
            padding: 15px;
            border: 2px solid #e8e8e8;
            border-radius: 8px;
            resize: vertical;
        }

        .quiz-nav {
            display: flex;
            justify-content: space-between;
            gap: 15px;
            margin-top: 25px;
        }

        .btn-custom {
            flex: 1;
            padding: 12px;
            font-size: 16px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-prev {
            background: #95a5a6;
            color: white;
        }

        .btn-prev:hover {
            background: #7f8c8d;
        }

        .btn-next {
            background: #3498db;
            color: white;
        }

        .btn-next:hover {
            background: #2980b9;
        }

        .btn-submit {
            background: #27ae60;
            color: white;
            font-size: 18px;
            font-weight: bold;
        }

        .btn-submit:hover {
            background: #229954;
        }

        .btn-submit:disabled {
            background: #95a5a6;
            cursor: not-allowed;
        }

        .question-progress {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .progress-bar-custom {
            height: 8px;
            background: #e8e8e8;
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.3s;
        }

        .quiz-finish {
            background: white;
            padding: 40px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .quiz-finish h2 {
            color: #27ae60;
            font-size: 32px;
            margin-bottom: 20px;
        }

        .finish-message {
            font-size: 18px;
            color: #555;
            margin-bottom: 30px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .error-message {
            background: #e74c3c;
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .timer-warning {
            color: #e74c3c;
            font-weight: bold;
        }

        @media (max-width: 768px) {
            .quiz-header {
                padding: 15px;
            }

            .quiz-info {
                flex-direction: column;
                gap: 10px;
            }

            .quiz-question {
                padding: 15px;
            }

            .question-text {
                font-size: 18px;
            }
        }
    </style>
</head>
<body>
    <!-- Add this right after the opening <body> tag of your exam taking page -->
<div id="voiceControlPanel" style="position: fixed; top: 20px; right: 20px; z-index: 1000; background: white; padding: 18px; border-radius: 12px; box-shadow: 0 8px 25px rgba(0,0,0,0.2); max-width: 320px; border: 2px solid rgba(102, 126, 234, 0.2);">
  <h3 style="margin: 0 0 14px 0; font-size: 17px; background: linear-gradient(135deg, #667eea, #764ba2); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight: 700;">üé§ Exam Voice Assistant</h3>
  
  <div style="margin-bottom: 12px;">
    <button id="toggleVoiceCommands" style="width: 100%; padding: 11px; border-radius: 10px; font-size: 13px; cursor: pointer; background: linear-gradient(135deg, #667eea, #764ba2); border: none; color: white; font-weight: 600; transition: all 0.2s; box-shadow: 0 4px 10px rgba(102, 126, 234, 0.3);">
      Start Voice Commands
    </button>
    <div id="voiceCommandStatus" style="margin-top: 8px; padding: 7px; background: #f8f9ff; border-radius: 7px; font-size: 12px; text-align: center; color: #666;">
      Click to activate
    </div>
  </div>

  <div style="margin-bottom: 12px;">
    <button id="toggleTextToSpeech" style="width: 100%; padding: 11px; border-radius: 10px; font-size: 13px; cursor: pointer; background: white; border: 2px solid #667eea; color: #667eea; font-weight: 600; transition: all 0.2s;">
      Enable Text-to-Speech
    </button>
    <div id="ttsStatus" style="margin-top: 8px; padding: 7px; background: #f8f9ff; border-radius: 7px; font-size: 12px; text-align: center; color: #666;">
      TTS: Inactive
    </div>
  </div>

  <div style="margin-bottom: 12px;">
    <label style="display: block; margin-bottom: 5px; font-size: 12px; color: #666; font-weight: 500;">Speech Speed</label>
    <input type="range" id="ttsSpeed" min="0.5" max="2" step="0.1" value="1" style="width: 100%; accent-color: #667eea;">
    <div style="display: flex; justify-content: space-between; font-size: 10px; color: #999; margin-top: 2px;">
      <span>Slow</span>
      <span>Normal</span>
      <span>Fast</span>
    </div>
  </div>

  <button id="stopSpeech" style="width: 100%; padding: 9px; border-radius: 8px; font-size: 12px; cursor: pointer; background: #fee2e2; border: 1px solid #fecaca; color: #dc2626; font-weight: 600; margin-bottom: 14px;">
    <i class="fas fa-stop-circle"></i> Stop Speech
  </button>

  <div style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.08), rgba(118, 75, 162, 0.08)); padding: 11px; border-radius: 10px; font-size: 11px; line-height: 1.6;">
    <strong style="color: #667eea; display: block; margin-bottom: 5px;">üì¢ Voice Commands:</strong>
    <ul style="margin: 0; padding-left: 18px; color: #555;">
      <li>"read question" - Read current question</li>
      <li>"option A/B/C/D" - Select option</li>
      <li>"select 1/2/3/4" - Select by number</li>
      <li>"next question" - Move to next</li>
      <li>"previous question" - Go back</li>
      <li>"submit exam" - Submit answers</li>
      <li>"read all options" - Read choices</li>
      <li>"time remaining" - Check timer</li>
    </ul>
    <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid rgba(102, 126, 234, 0.15);">
      <strong style="color: #667eea;">‚å®Ô∏è Shortcuts:</strong><br>
      <span style="color: #666;"><strong>V</strong> - TTS | <strong>O</strong> - Voice | <strong>Esc</strong> - Stop</span>
    </div>
  </div>

  <div id="voiceIndicator" style="margin-top: 12px; padding: 9px; background: rgba(220, 38, 38, 0.1); border-radius: 8px; text-align: center; display: none; border: 1px solid rgba(220, 38, 38, 0.2);">
    <span style="color: #dc2626; font-size: 12px; font-weight: 600;">üî¥ Listening...</span>
  </div>

  <div id="voiceConfirmation" style="margin-top: 12px; padding: 9px; background: rgba(34, 197, 94, 0.1); border-radius: 8px; text-align: center; display: none; border: 1px solid rgba(34, 197, 94, 0.2);">
    <span style="color: #16a34a; font-size: 12px; font-weight: 600;">‚úì <span id="confirmationText">Action completed</span></span>
  </div>
</div>

<script>
  // Voice Control System for Exam Taking
  class ExamTakingVoiceSystem {
    constructor() {
      this.synthesis = window.speechSynthesis;
      this.recognition = null;
      this.isListening = false;
      this.isTTSEnabled = false;
      this.voiceSpeed = 1;
      this.currentUtterance = null;
      this.hoverTimeout = null;
      this.currentQuestion = null;
      this.init();
    }

    init() {
      this.setupSpeechRecognition();
      this.setupControls();
      this.setupKeyboardShortcuts();
      this.setupAutoQuestionDetection();
    }

    setupSpeechRecognition() {
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      
      if (!SpeechRecognition) {
        console.warn('Speech recognition not supported');
        return;
      }

      this.recognition = new SpeechRecognition();
      this.recognition.continuous = true;
      this.recognition.interimResults = false;
      this.recognition.lang = 'en-US';

      this.recognition.onstart = () => {
        document.getElementById('voiceIndicator').style.display = 'block';
      };

      this.recognition.onend = () => {
        document.getElementById('voiceIndicator').style.display = 'none';
        if (this.isListening) {
          setTimeout(() => {
            try {
              this.recognition.start();
            } catch(e) {
              console.log('Recognition restart failed');
            }
          }, 100);
        }
      };

      this.recognition.onresult = (event) => {
        const last = event.results.length - 1;
        const command = event.results[last][0].transcript.toLowerCase().trim();
        console.log('Voice command:', command);
        this.processVoiceCommand(command);
      };

      this.recognition.onerror = (event) => {
        console.error('Speech recognition error:', event.error);
        if (event.error === 'no-speech' && this.isListening) {
          setTimeout(() => {
            try {
              this.recognition.start();
            } catch(e) {}
          }, 100);
        }
      };
    }

    setupControls() {
      const toggleVoiceBtn = document.getElementById('toggleVoiceCommands');
      const toggleTTSBtn = document.getElementById('toggleTextToSpeech');
      const speedControl = document.getElementById('ttsSpeed');
      const stopBtn = document.getElementById('stopSpeech');

      if (toggleVoiceBtn) {
        toggleVoiceBtn.addEventListener('click', () => this.toggleVoiceCommands());
      }
      
      if (toggleTTSBtn) {
        toggleTTSBtn.addEventListener('click', () => this.toggleTextToSpeech());
      }
      
      if (speedControl) {
        speedControl.addEventListener('input', (e) => {
          this.voiceSpeed = parseFloat(e.target.value);
        });
      }

      if (stopBtn) {
        stopBtn.addEventListener('click', () => this.stopSpeaking());
      }
    }

    setupKeyboardShortcuts() {
      document.addEventListener('keydown', (e) => {
        const activeElement = document.activeElement;
        const isTyping = activeElement.tagName === 'INPUT' || 
                         activeElement.tagName === 'TEXTAREA';
        
        if (isTyping) return;
        
        // V key to toggle text-to-speech
        if (e.key.toLowerCase() === 'v') {
          e.preventDefault();
          this.toggleTextToSpeech();
        }
        
        // O key to toggle voice commands
        if (e.key.toLowerCase() === 'o') {
          e.preventDefault();
          this.toggleVoiceCommands();
        }
        
        // Escape to stop speaking
        if (e.key === 'Escape') {
          e.preventDefault();
          this.stopSpeaking();
        }

        // R key to read current question
        if (e.key.toLowerCase() === 'r' && !isTyping) {
          e.preventDefault();
          this.readCurrentQuestion();
        }
      });
    }

    setupAutoQuestionDetection() {
      // Monitor DOM for question changes
      const observer = new MutationObserver(() => {
        this.updateCurrentQuestion();
      });

      // Observe the entire document for changes
      observer.observe(document.body, { 
        childList: true, 
        subtree: true 
      });

      // Initial update
      setTimeout(() => this.updateCurrentQuestion(), 1000);
    }

    updateCurrentQuestion() {
      // Try multiple selectors to find the current question
      const questionSelectors = [
        '.question-text',
        '.question',
        '[class*="question"]',
        'h3', // fallback
        'h4'
      ];

      for (const selector of questionSelectors) {
        const element = document.querySelector(selector);
        if (element && element.textContent.trim()) {
          this.currentQuestion = element;
          break;
        }
      }
    }

    toggleVoiceCommands() {
      if (!this.recognition) {
        this.speak('Voice commands are not supported in your browser. Please use Chrome or Edge.');
        return;
      }

      this.isListening = !this.isListening;
      const btn = document.getElementById('toggleVoiceCommands');
      const status = document.getElementById('voiceCommandStatus');

      if (this.isListening) {
        try {
          this.recognition.start();
          btn.textContent = 'Stop Voice Commands';
          btn.style.background = '#dc2626';
          status.textContent = 'üé§ Listening...';
          status.style.background = 'rgba(220, 38, 38, 0.1)';
          status.style.color = '#dc2626';
          this.updateCurrentQuestion();
          this.speak('Voice commands activated. You can now answer questions using your voice. Say read question to hear the current question, or say option A, B, C, or D to select an answer.');
        } catch(e) {
          console.error('Failed to start recognition:', e);
          this.isListening = false;
        }
      } else {
        this.recognition.stop();
        btn.textContent = 'Start Voice Commands';
        btn.style.background = 'linear-gradient(135deg, #667eea, #764ba2)';
        status.textContent = 'Click to activate';
        status.style.background = '#f8f9ff';
        status.style.color = '#666';
        this.speak('Voice commands deactivated.');
      }
    }

    toggleTextToSpeech() {
      this.isTTSEnabled = !this.isTTSEnabled;
      const btn = document.getElementById('toggleTextToSpeech');
      const status = document.getElementById('ttsStatus');

      if (this.isTTSEnabled) {
        btn.textContent = 'Disable Text-to-Speech';
        btn.style.background = '#667eea';
        btn.style.color = 'white';
        btn.style.borderColor = '#667eea';
        status.textContent = 'TTS: Active ‚úì';
        status.style.background = '#dcfce7';
        status.style.color = '#166534';
        this.speak('Text to speech enabled. Hover over questions and options to hear them read aloud.');
        this.enableHoverReading();
      } else {
        btn.textContent = 'Enable Text-to-Speech';
        btn.style.background = 'white';
        btn.style.color = '#667eea';
        btn.style.borderColor = '#667eea';
        status.textContent = 'TTS: Inactive';
        status.style.background = '#f8f9ff';
        status.style.color = '#666';
        this.stopSpeaking();
        this.disableHoverReading();
        this.speak('Text to speech disabled.');
      }
    }

    enableHoverReading() {
      const readableElements = document.querySelectorAll(
        '.question, .question-text, .option, .answer-option, label, button, h1, h2, h3, h4, p, [class*="question"], [class*="option"]'
      );
      readableElements.forEach(el => {
        el.addEventListener('mouseenter', this.handleHover);
        el.dataset.ttsEnabled = 'true';
      });
    }

    disableHoverReading() {
      const readableElements = document.querySelectorAll('[data-tts-enabled="true"]');
      readableElements.forEach(el => {
        el.removeEventListener('mouseenter', this.handleHover);
        delete el.dataset.ttsEnabled;
      });
    }

    handleHover = (e) => {
      if (!this.isTTSEnabled) return;
      
      clearTimeout(this.hoverTimeout);
      this.hoverTimeout = setTimeout(() => {
        const el = e.target;
        let text = el.textContent.trim();
        
        // Clean up the text
        if (text.length > 300) {
          text = text.substring(0, 300) + '...';
        }
        
        if (text && text.length > 2) {
          this.speak(text);
        }
      }, 400);
    }

    processVoiceCommand(command) {
      console.log('Processing exam command:', command);
      
      // Read current question
      if (command.includes('read question') || command.includes('read this question') || command.includes('what is the question')) {
        this.readCurrentQuestion();
      }
      // Read all options
      else if (command.includes('read options') || command.includes('read all options') || command.includes('read choices')) {
        this.readAllOptions();
      }
      // Select option by letter (A, B, C, D)
      else if (command.match(/\b(option\s+)?([a-d])\b/i)) {
        const match = command.match(/\b(option\s+)?([a-d])\b/i);
        const option = match[2].toUpperCase();
        this.selectOption(option);
      }
      // Select option by number (1, 2, 3, 4)
      else if (command.match(/\b(select\s+|option\s+|choose\s+)?(one|two|three|four|1|2|3|4)\b/i)) {
        const match = command.match(/\b(select\s+|option\s+|choose\s+)?(one|two|three|four|1|2|3|4)\b/i);
        let num = match[2];
        
        // Convert word to number
        const wordToNum = { 'one': '1', 'two': '2', 'three': '3', 'four': '4' };
        if (wordToNum[num]) {
          num = wordToNum[num];
        }
        
        // Convert number to letter
        const numToLetter = { '1': 'A', '2': 'B', '3': 'C', '4': 'D' };
        const option = numToLetter[num];
        this.selectOption(option);
      }
      // Navigation
      else if (command.includes('next question') || command.includes('next') || command.includes('move forward')) {
        this.navigateQuestion('next');
      }
      else if (command.includes('previous question') || command.includes('previous') || command.includes('go back') || command.includes('back')) {
        this.navigateQuestion('previous');
      }
      // Submit exam
      else if (command.includes('submit exam') || command.includes('finish exam') || command.includes('submit test')) {
        this.submitExam();
      }
      // Time remaining
      else if (command.includes('time remaining') || command.includes('how much time') || command.includes('check time')) {
        this.readTimeRemaining();
      }
      // Current question number
      else if (command.includes('question number') || command.includes('which question') || command.includes('current question')) {
        this.readQuestionNumber();
      }
      // Clear selection
      else if (command.includes('clear answer') || command.includes('unselect') || command.includes('deselect')) {
        this.clearSelection();
      }
      // Scroll
      else if (command.includes('scroll down')) {
        window.scrollBy({ top: 300, behavior: 'smooth' });
        this.speak('Scrolling down');
      }
      else if (command.includes('scroll up')) {
        window.scrollBy({ top: -300, behavior: 'smooth' });
        this.speak('Scrolling up');
      }
      // Help
      else if (command.includes('help') || command.includes('what can you do') || command.includes('commands')) {
        this.speak('You can say: read question to hear the current question. Say option A, B, C, or D to select an answer. Say select 1, 2, 3, or 4 for the same. Say next question or previous question to navigate. Say submit exam when finished. Say time remaining to check the timer. Say help to hear this again.');
      }
      // Stop
      else if (command.includes('stop') || command.includes('quiet') || command.includes('silence')) {
        this.stopSpeaking();
      }
      else {
        this.speak('Command not recognized. Say help to hear available commands.');
      }
    }

    readCurrentQuestion() {
      this.updateCurrentQuestion();
      
      if (!this.currentQuestion) {
        this.speak('Unable to find the current question');
        return;
      }

      const questionText = this.currentQuestion.textContent.trim();
      this.speak(`Current question: ${questionText}`);
    }

    readAllOptions() {
      // Try to find all options
      const optionSelectors = [
        '.option',
        '.answer-option',
        '[class*="option"]',
        'label',
        'input[type="radio"] + label',
        'input[type="radio"]'
      ];

      let options = [];
      for (const selector of optionSelectors) {
        const elements = document.querySelectorAll(selector);
        if (elements.length >= 2) {
          options = Array.from(elements);
          break;
        }
      }

      if (options.length === 0) {
        this.speak('Unable to find answer options');
        return;
      }

      let optionsText = 'The options are: ';
      options.forEach((option, index) => {
        const letter = String.fromCharCode(65 + index); // A, B, C, D
        const text = option.textContent.trim();
        optionsText += `Option ${letter}: ${text}. `;
      });

      this.speak(optionsText);
    }

    selectOption(optionLetter) {
      console.log('Selecting option:', optionLetter);
      
      // Try multiple strategies to find and select the option
      const strategies = [
        // Strategy 1: Find radio button by value or id
        () => {
          const radio = document.querySelector(`input[type="radio"][value="${optionLetter}"], input[type="radio"][id*="${optionLetter.toLowerCase()}"]`);
          return radio;
        },
        // Strategy 2: Find by label text starting with the letter
        () => {
          const labels = document.querySelectorAll('label');
          for (const label of labels) {
            if (label.textContent.trim().toUpperCase().startsWith(optionLetter)) {
              const radio = document.querySelector(`input[type="radio"][id="${label.htmlFor}"]`) || 
                           label.querySelector('input[type="radio"]');
              return radio;
            }
          }
          return null;
        },
        // Strategy 3: Find by index (A=0, B=1, C=2, D=3)
        () => {
          const radios = document.querySelectorAll('input[type="radio"]');
          const index = optionLetter.charCodeAt(0) - 65; // A=0, B=1, etc.
          return radios[index];
        },
        // Strategy 4: Find button or clickable element
        () => {
          const buttons = document.querySelectorAll(`button, .option, [class*="option"]`);
          for (const btn of buttons) {
            if (btn.textContent.trim().toUpperCase().startsWith(optionLetter)) {
              return btn;
            }
          }
          return null;
        }
      ];

      let element = null;
      for (const strategy of strategies) {
        element = strategy();
        if (element) break;
      }

      if (element) {
        element.click();
        this.speak(`Option ${optionLetter} selected`);
        this.showConfirmation(`Option ${optionLetter} selected`);
      } else {
        this.speak(`Unable to select option ${optionLetter}`);
      }
    }

    navigateQuestion(direction) {
      // Try to find next/previous buttons
      const buttonSelectors = [
        direction === 'next' ? 'button:contains("Next")' : 'button:contains("Previous")',
        direction === 'next' ? '[class*="next"]' : '[class*="prev"]',
        direction === 'next' ? '#nextBtn' : '#prevBtn',
        direction === 'next' ? '.btn-next' : '.btn-previous'
      ];

      // Use a more robust search
      const buttons = document.querySelectorAll('button');
      let targetButton = null;

      for (const btn of buttons) {
        const text = btn.textContent.toLowerCase();
        if (direction === 'next' && (text.includes('next') || text.includes('forward'))) {
          targetButton = btn;
          break;
        } else if (direction === 'previous' && (text.includes('prev') || text.includes('back'))) {
          targetButton = btn;
          break;
        }
      }

      if (targetButton) {
        targetButton.click();
        this.speak(`Moving to ${direction} question`);
        this.showConfirmation(`${direction} question`);
        
        // Read new question after navigation
        setTimeout(() => {
          this.updateCurrentQuestion();
          if (this.isTTSEnabled) {
            this.readCurrentQuestion();
          }
        }, 500);
      } else {
        this.speak(`Unable to find ${direction} button`);
      }
    }

    submitExam() {
      this.speak('Are you sure you want to submit the exam? Click the submit button to confirm.');
      
      // Try to find submit button
      const buttons = document.querySelectorAll('button');
      for (const btn of buttons) {
        const text = btn.textContent.toLowerCase();
        if (text.includes('submit') || text.includes('finish') || text.includes('complete')) {
          // Highlight the button
          btn.style.boxShadow = '0 0 20px rgba(102, 126, 234, 0.8)';
          setTimeout(() => {
            btn.style.boxShadow = '';
          }, 2000);
          break;
        }
      }
    }

    readTimeRemaining() {
      // Try to find timer element
      const timerSelectors = [
        '#timer',
        '.timer',
        '[class*="timer"]',
        '[id*="time"]',
        '[class*="time"]'
      ];

      let timerElement = null;
      for (const selector of timerSelectors) {
        const element = document.querySelector(selector);
        if (element && element.textContent.match(/\d+/)) {
          timerElement = element;
          break;
        }
      }

      if (timerElement) {
        const timeText = timerElement.textContent.trim();
        this.speak(`Time remaining: ${timeText}`);
      } else {
        this.speak('Unable to find timer');
      }
    }

    readQuestionNumber() {
      // Try to find question number indicator
      const indicators = document.querySelectorAll('[class*="question"], h3, h4');
      
      for (const indicator of indicators) {
        const text = indicator.textContent;
        const match = text.match(/question\s+(\d+)/i);
        if (match) {
          this.speak(`You are on question ${match[1]}`);
          return;
        }
      }
      
      this.speak('Unable to determine question number');
    }

    clearSelection() {
      const radios = document.querySelectorAll('input[type="radio"]:checked');
      radios.forEach(radio => {
        radio.checked = false;
      });
      
      if (radios.length > 0) {
        this.speak('Selection cleared');
        this.showConfirmation('Selection cleared');
      } else {
        this.speak('No selection to clear');
      }
    }

    showConfirmation(text) {
      const confirmDiv = document.getElementById('voiceConfirmation');
      const confirmText = document.getElementById('confirmationText');
      
      if (confirmDiv && confirmText) {
        confirmText.textContent = text;
        confirmDiv.style.display = 'block';
        
        setTimeout(() => {
          confirmDiv.style.display = 'none';
        }, 2000);
      }
    }

    speak(text) {
      this.synthesis.cancel();
      
      if (!text) return;

      const utterance = new SpeechSynthesisUtterance(text);
      utterance.rate = this.voiceSpeed;
      utterance.pitch = 1;
      utterance.volume = 1;
      utterance.lang = 'en-US';

      this.currentUtterance = utterance;
      this.synthesis.speak(utterance);
    }

    stopSpeaking() {
      this.synthesis.cancel();
      clearTimeout(this.hoverTimeout);
    }
  }

  // Initialize the voice control system for exam taking
  let examTakingVoiceSystem;
  window.addEventListener('load', () => {
    setTimeout(() => {
      examTakingVoiceSystem = new ExamTakingVoiceSystem();
      console.log('Exam taking voice control system initialized');
      
      // Welcome message
      setTimeout(() => {
        examTakingVoiceSystem.speak('Welcome to the exam. Press O to activate voice commands for hands-free exam taking. Press V for text to speech. Press R to read the current question. Say help to hear all available commands.');
      }, 1500);
    }, 500);
  });
</script>
    <div class="quiz-container">
        <!-- Loading State -->
        <div id="loadingState" class="loading">
            <div class="spinner-border" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-3">Loading quiz...</p>
        </div>

        <!-- Error State -->
        <div id="errorState" style="display: none;">
            <div class="error-message" id="errorMessage"></div>
            <button class="btn btn-primary" onclick="goBack()">Go Back</button>
        </div>

        <!-- Quiz State -->
        <div id="quizState" style="display: none;">
            <!-- Quiz Header -->
            <div class="quiz-header">
                <h1 class="quiz-title" id="quizTitle"></h1>
                <div class="quiz-info">
                    <div class="info-item">
                        <i class="fas fa-clock"></i>
                        <span>Time Remaining: <span class="timer" id="timer">--:--</span></span>
                    </div>
                    <div class="info-item">
                        <i class="fas fa-list"></i>
                        <span>Question <span id="currentQuestion">0</span> of <span id="totalQuestions">0</span></span>
                    </div>
                </div>
            </div>

            <!-- Question Progress -->
            <div class="question-progress">
                <div class="progress-bar-custom">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
            </div>

            <!-- Current Question -->
            <div class="quiz-question">
                <div class="question-number">Question <span id="qNum">1</span> of <span id="qTotal">0</span></div>
                <div class="question-text" id="questionText"></div>
                <div id="optionsContainer"></div>
            </div>

            <!-- Navigation Buttons -->
            <div class="quiz-nav">
                <button class="btn-custom btn-prev" id="prevBtn" onclick="previousQuestion()" style="display: none;">
                    <i class="fas fa-chevron-left me-2"></i>Previous
                </button>
                <button class="btn-custom btn-next" id="nextBtn" onclick="nextQuestion()">
                    Next<i class="fas fa-chevron-right ms-2"></i>
                </button>
                <button class="btn-custom btn-submit" id="submitBtn" onclick="submitQuiz()" style="display: none;">
                    <i class="fas fa-check me-2"></i>Submit Quiz
                </button>
            </div>
        </div>

        <!-- Quiz Finish State -->
        <div id="finishState" style="display: none;">
            <div class="quiz-finish">
                <h2><i class="fas fa-check-circle"></i> Quiz Submitted!</h2>
                <p class="finish-message" id="finishMessage"></p>
                <button class="btn btn-primary btn-lg" onclick="goToExamList()">
                    <i class="fas fa-arrow-left me-2"></i>Back to Exams
                </button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="shared/student-quiz.js"></script>
</body>
</html>
